# WooCommerce PIX Payment

## Descri√ß√£o
Este plugin adiciona um m√©todo de pagamento PIX ao WooCommerce. Ele gera um QR Code din√¢mico com base no valor total do pedido e exibe-o na p√°gina de agradecimento ap√≥s o checkout.

## Como Usar
1. Ative o plugin em **Plugins > Plugins Instalados**.
2. V√° para **WooCommerce > Configura√ß√µes > Pagamentos**.
3. Habilite o m√©todo "PIX Payment".
4. Configure o t√≠tulo e descri√ß√£o.
5. Use o m√©todo no checkout.

## Requisitos
- WordPress 5.0+
- WooCommerce 4.0+
- PHP 7.2+

## Desinstala√ß√£o
1. Desative o plugin.
2. Exclua a pasta `woo-pix-payment` do diret√≥rio `/wp-content/plugins/`.

### ARQUIVO PRINCIPAL (woo-pix-pagament.php)

‚úÖ Explica√ß√£o Passo a Passo
üîπ 1. Prote√ß√£o Contra Acesso Direto
A linha if (!defined('ABSPATH')) { exit; } garante que o arquivo s√≥ seja executado dentro do WordPress. Isso evita que algu√©m acesse o arquivo diretamente via URL, o que poderia causar erros ou expor informa√ß√µes sens√≠veis.
üîπ 2. Inclus√£o de Arquivos Externos
O plugin √© modular, ent√£o dividimos as funcionalidades em arquivos separados:
class-wc-pix-gateway.php: Cont√©m a classe que implementa o m√©todo de pagamento PIX no WooCommerce.
qr-code-generator.php: Cont√©m a fun√ß√£o para gerar o QR Code usando a API do Supabase.
Usamos plugin_dir_path(__FILE__) para garantir que os caminhos dos arquivos sejam absolutos e funcionem corretamente.
üîπ 3. Carregamento de CSS e JS
Os arquivos CSS e JS s√£o opcionais, mas √∫teis para estilizar o QR Code e adicionar interatividade (como um bot√£o para WhatsApp).
wp_enqueue_style e wp_enqueue_script s√£o fun√ß√µes nativas do WordPress para carregar recursos externos.
üîπ 4. Suporte ao Multisite
O WordPress Multisite permite criar v√°rias lojas em um √∫nico site. Cada loja pode ter sua pr√≥pria configura√ß√£o de chave PIX.
A fun√ß√£o is_multisite() verifica se o WordPress est√° configurado como Multisite.
Um aviso √© exibido no painel do Multisite para informar que o plugin foi ativado em todos os sites.
üîπ 5. Configura√ß√£o da Chave PIX
Para permitir que cada site do Multisite tenha sua pr√≥pria chave PIX, adicionamos um campo personalizado no WooCommerce.
A fun√ß√£o add_pix_gateway_settings inclui um arquivo adicional (class-wc-pix-settings.php) que define as configura√ß√µes espec√≠ficas do plugin.

### ARQUIVO (class-wc-pix-gateway.php)

‚úÖ Explica√ß√£o Passo a Passo
üîπ 1. Prote√ß√£o Contra Acesso Direto
A linha if (!defined('ABSPATH')) { exit; } garante que o arquivo s√≥ seja executado dentro do WordPress. Isso evita que algu√©m acesse o arquivo diretamente via URL.
üîπ 2. Classe WC_Pix_Gateway
Esta classe implementa o m√©todo de pagamento PIX no WooCommerce.
Ela estende a classe WC_Payment_Gateway, que √© nativa do WooCommerce e fornece m√©todos para criar gateways de pagamento personalizados.
üîπ 3. Construtor (__construct)
O construtor define as propriedades b√°sicas do gateway:
$this->id: ID √∫nico para o gateway (pix_payment).
$this->icon: √çcone opcional (pode ser uma imagem ou SVG).
$this->method_title: T√≠tulo exibido no painel do WooCommerce.
$this->method_description: Descri√ß√£o exibida no painel do WooCommerce.
üîπ 4. M√©todo init_form_fields
Este m√©todo define os campos que aparecem na p√°gina de configura√ß√µes do WooCommerce:
Habilitar/Desabilitar: Um checkbox para ativar ou desativar o gateway.
T√≠tulo: O nome do m√©todo de pagamento exibido no checkout.
Descri√ß√£o: Uma descri√ß√£o exibida no checkout.
üîπ 5. M√©todo process_payment
Este m√©todo define o comportamento do gateway ao processar um pedido:
Atualiza o status do pedido para "Em espera" (on-hold).
Limpa o carrinho do cliente.
Redireciona o cliente para a p√°gina de agradecimento.
üîπ 6. Compatibilidade com Multisite
No WordPress Multisite, cada site tem suas pr√≥prias configura√ß√µes.
Quando voc√™ acessa o painel de administra√ß√£o de um site espec√≠fico, as configura√ß√µes definidas aqui ser√£o salvas apenas para aquele site.
Isso permite que cada site do Multisite tenha seu pr√≥prio t√≠tulo e descri√ß√£o para o m√©todo de pagamento PIX.
‚úÖ Dados Preenchidos para o Primeiro Site
Para o site https://pedidossimples.com.br/mercearia-luanda/, voc√™ pode configurar o seguinte:

Chave PIX: 01083172778
Nome da Loja: Mercearia Luanda
Cidade: Rio de Janeiro, RJ


### C√ìDIGO (generate-qr-code.php)

‚úÖ Explica√ß√£o Passo a Passo
üîπ 1. Prote√ß√£o Contra Acesso Direto
A linha if (!defined('ABSPATH')) { exit; } garante que o arquivo s√≥ seja executado dentro do WordPress. Isso evita que algu√©m acesse o arquivo diretamente via URL.
üîπ 2. Configura√ß√µes do Site Atual
O c√≥digo identifica o site atual usando get_bloginfo('name'), que retorna o nome do site (ex: "Mercearia Luanda").
Convertendo o nome do site para um formato de slug (ex: "mercearia-luanda"), podemos associ√°-lo √†s configura√ß√µes PIX corretas.
As configura√ß√µes PIX (chave, nome da loja e cidade) s√£o armazenadas em um array $pix_settings. Voc√™ pode adicionar novas lojas facilmente ao array.
üîπ 3. Gerar o Payload PIX
O payload PIX segue o formato fixo do Banco Central do Brasil.
Ele inclui:
A chave PIX ($pix_key),
O valor total do pedido ($amount),
O nome da loja ($merchant_name),
A cidade da loja ($merchant_city).
üîπ 4. Chamar a API do Supabase
A URL da API Supabase √© constru√≠da com o payload PIX codificado.
O token p√∫blico (anon) √© usado para autenticar a requisi√ß√£o.
A fun√ß√£o wp_remote_get faz a chamada √† API e retorna o QR Code gerado.
‚úÖ Como Adicionar Novas Lojas?

Para adicionar uma nova loja, basta incluir uma nova entrada no array $pix_settings:
'nova-loja' => array(
    'key'   => 'nova_chave_pix',
    'name'  => 'Nova Loja',
    'city'  => 'Cidade da Nova Loja',
),

‚úÖ Dados Reais Inseridos
URL do Projeto Supabase: https://czzidhzzpqegfvvmdgno.supabase.co
Token Anon: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN6emlkaHp6cHFlZ2Z2dm1kZ25vIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI5NTIwMDMsImV4cCI6MjA2ODUyODAwM30.zK2iFp-b4e5vghpHgWGuOk0LooujlyU7kVm4sbM85m0

##  ARQUIVO (class-wc-pix-setting.php)

‚úÖ Explica√ß√£o Passo a Passo
üîπ 1. Prote√ß√£o Contra Acesso Direto
A linha if (!defined('ABSPATH')) { exit; } garante que o arquivo s√≥ seja executado dentro do WordPress.
üîπ 2. Identifica√ß√£o do Site Atual
O c√≥digo usa get_bloginfo('name') para obter o nome do site atual (ex: "Mercearia Luanda").
Ele converte o nome para um formato de slug (ex: "mercearia-luanda") usando strtolower e str_replace.
üîπ 3. Configura√ß√µes Padr√£o por Site
Um array $default_pix_settings armazena as configura√ß√µes PIX para cada site:
Chave PIX: Exemplo: 01083172778 para "Mercearia Luanda".
Nome da Loja: Exemplo: "Mercearia Luanda".
Cidade: Exemplo: "Rio de Janeiro, RJ".
üîπ 4. Recupera√ß√£o das Configura√ß√µes do Site Atual
O c√≥digo verifica se o slug do site atual existe no array $default_pix_settings.
Se existir, ele carrega as configura√ß√µes correspondentes. Caso contr√°rio, define valores padr√£o vazios.
üîπ 5. Campos de Configura√ß√£o
O m√©todo get_settings define tr√™s campos personalizados:
Chave PIX: Um campo de texto para inserir a chave PIX.
Nome da Loja: Um campo de texto para inserir o nome da loja.
Cidade: Um campo de texto para inserir a cidade da loja.
‚úÖ Como Funciona na Pr√°tica?
Acesse o Painel do WooCommerce:
Em qualquer site do Multisite, v√° para WooCommerce > Configura√ß√µes > Pagamentos.
Habilite o m√©todo "PIX Payment".
Configure os Dados PIX:
Na aba Configura√ß√µes do PIX, voc√™ ver√° os campos preenchidos automaticamente com os dados do site atual:
Para https://pedidossimples.com.br/mercearia-luanda/:
Chave PIX: 01083172778
Nome da Loja: Mercearia Luanda
Cidade: Rio de Janeiro, RJ
Para https://pedidossimples.com.br/3g-luanda/:
Chave PIX: celulardabelinalva@gmail.com
Nome da Loja: 3G Luanda
Cidade: Rio de Janeiro, RJ
Salve as Configura√ß√µes:
As configura√ß√µes ser√£o salvas apenas para aquele site."# woo-pix-payment" 
